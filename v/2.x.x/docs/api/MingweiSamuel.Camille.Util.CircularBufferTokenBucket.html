<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Class CircularBufferTokenBucket
   </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Class CircularBufferTokenBucket
   ">
    <meta name="generator" content="docfx 2.59.2.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket">
  
  
  <h1 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket" class="text-break">Class CircularBufferTokenBucket
  </h1>
  <div class="markdown level0 summary"><p>A circular buffer keeps track of tokens. The value of each buffer index represents the number of requests
sent during that time period and as time passes, old indices are zeroed and the current index advances.The
entire length of the buffer minus one represents a entire timespan (each index represents a fraction of the
total timespan). The extra index prevents violations due to bucket misalignment.A rolling total is kept of
the buffer&apos;s contents.</p>
<p>When trying to obtain a token, we first check the rolling total is less than the limit.If so, we obtain
a token by incrementing the rolling total and incrementing the buffer&apos;s current index.</p>
<p>The length of the buffer is one more than the temporal factor supplied to the constructor. The temporal
factor represents the multiplicative increase in temporal resolution provided with more buffer indices.</p>
<p>Additionally, a non-zero spreading factor can be provided to prevent a single index from supplying all of
a timespan&apos;s tokens. A spreading factor of 0.0 means no spreading, a factor of 0.5 means each index can
supply up to half of the tokens, and a factor of 1.0 means tokens will be evenly supplied by all indices
(provided there is enough demand).</p>
<p>Checking the availability of tokens is done using the {@link #getDelay()} method. Tokens are obtained
using the {@link #getToken()} method. Both these methods are synchronized on the bucket instance. Because
the state of the bucket may change if there are multiple threads, it is best to call these methods in a
synchronized block, as shown below.</p>
<pre><code>ITokenBucket bucket = ...;
while (true)
{
    long delay;
    synchronized(bucket) {
        delay = bucket.getDelay();
        if (delay == -1)
        {
            bucket.GetTokens(1);
            break;
        }
    }
    // Waiting is done outside of the synchronized block.
    Thread.sleep(delay);
}
// Token is obtained.
...</code></pre>
</div>
  <div class="markdown level0 conceptual"></div>
  <div class="inheritance">
    <h5>Inheritance</h5>
    <div class="level0"><span class="xref">System.Object</span></div>
    <div class="level1"><span class="xref">CircularBufferTokenBucket</span></div>
  </div>
  <div classs="implements">
    <h5>Implements</h5>
    <div><a class="xref" href="MingweiSamuel.Camille.Util.ITokenBucket.html">ITokenBucket</a></div>
  </div>
  <div class="inheritedMembers">
    <h5>Inherited Members</h5>
    <div>
      <span class="xref">System.Object.ToString()</span>
    </div>
    <div>
      <span class="xref">System.Object.Equals(System.Object)</span>
    </div>
    <div>
      <span class="xref">System.Object.Equals(System.Object, System.Object)</span>
    </div>
    <div>
      <span class="xref">System.Object.ReferenceEquals(System.Object, System.Object)</span>
    </div>
    <div>
      <span class="xref">System.Object.GetHashCode()</span>
    </div>
    <div>
      <span class="xref">System.Object.GetType()</span>
    </div>
    <div>
      <span class="xref">System.Object.MemberwiseClone()</span>
    </div>
  </div>
  <h6><strong>Namespace</strong>: <a class="xref" href="MingweiSamuel.Camille.Util.html">MingweiSamuel.Camille.Util</a></h6>
  <h6><strong>Assembly</strong>: Camille.dll</h6>
  <h5 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_syntax">Syntax</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public class CircularBufferTokenBucket : ITokenBucket</code></pre>
  </div>
  <h3 id="constructors">Constructors
  </h3>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/MingweiSamuel/Camille/new/release/2.x.x/apiSpec/new?filename=MingweiSamuel_Camille_Util_CircularBufferTokenBucket__ctor_System_TimeSpan_System_Int32_System_Int32_System_Single_System_Single_.md&amp;value=---%0Auid%3A%20MingweiSamuel.Camille.Util.CircularBufferTokenBucket.%23ctor(System.TimeSpan%2CSystem.Int32%2CSystem.Int32%2CSystem.Single%2CSystem.Single)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/MingweiSamuel/Camille/blob/release/2.x.x/Camille/src/Util/CircularBufferTokenBucket.cs/#L86">View Source</a>
  </span>
  <a id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket__ctor_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.#ctor*"></a>
  <h4 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket__ctor_System_TimeSpan_System_Int32_System_Int32_System_Single_System_Single_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.#ctor(System.TimeSpan,System.Int32,System.Int32,System.Single,System.Single)">CircularBufferTokenBucket(TimeSpan, Int32, Int32, Single, Single)</h4>
  <div class="markdown level1 summary"><p>Main constructor.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public CircularBufferTokenBucket(TimeSpan timeSpan, int totalLimit, int temporalFactor, float spreadFactor, float totalLimitFactor)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.TimeSpan</span></td>
        <td><span class="parametername">timeSpan</span></td>
        <td><p>Timespan of this bucket.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Int32</span></td>
        <td><span class="parametername">totalLimit</span></td>
        <td><p>Total limit of this bucket.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Int32</span></td>
        <td><span class="parametername">temporalFactor</span></td>
        <td><p>Temporal multiplier corresponding to token time tracking.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Single</span></td>
        <td><span class="parametername">spreadFactor</span></td>
        <td><p>Factor corresponding to token supply spread (from multiple indices).</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Single</span></td>
        <td><span class="parametername">totalLimitFactor</span></td>
        <td><p>Factor to multiply adjustedTotalLimit by to decrease the chance of hitting the rate limit.</p>
</td>
      </tr>
    </tbody>
  </table>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/MingweiSamuel/Camille/new/release/2.x.x/apiSpec/new?filename=MingweiSamuel_Camille_Util_CircularBufferTokenBucket__ctor_System_TimeSpan_System_Int32_System_Int32_System_Single_System_Single_System_Func_System_Int64__.md&amp;value=---%0Auid%3A%20MingweiSamuel.Camille.Util.CircularBufferTokenBucket.%23ctor(System.TimeSpan%2CSystem.Int32%2CSystem.Int32%2CSystem.Single%2CSystem.Single%2CSystem.Func%7BSystem.Int64%7D)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/MingweiSamuel/Camille/blob/release/2.x.x/Camille/src/Util/CircularBufferTokenBucket.cs/#L101">View Source</a>
  </span>
  <a id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket__ctor_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.#ctor*"></a>
  <h4 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket__ctor_System_TimeSpan_System_Int32_System_Int32_System_Single_System_Single_System_Func_System_Int64__" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.#ctor(System.TimeSpan,System.Int32,System.Int32,System.Single,System.Single,System.Func{System.Int64})">CircularBufferTokenBucket(TimeSpan, Int32, Int32, Single, Single, Func&lt;Int64&gt;)</h4>
  <div class="markdown level1 summary"><p>Secondary constructor, mainly for debugging.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public CircularBufferTokenBucket(TimeSpan timeSpan, int totalLimit, int temporalFactor, float spreadFactor, float totalLimitFactor, Func&lt;long&gt; tickSupplier)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.TimeSpan</span></td>
        <td><span class="parametername">timeSpan</span></td>
        <td><p>Timespan of this bucket.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Int32</span></td>
        <td><span class="parametername">totalLimit</span></td>
        <td><p>Total limit of this bucket.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Int32</span></td>
        <td><span class="parametername">temporalFactor</span></td>
        <td><p>Temporal multiplier corresponding to token time tracking.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Single</span></td>
        <td><span class="parametername">spreadFactor</span></td>
        <td><p>Factor corresponding to token supply spread (from multiple indices).</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Single</span></td>
        <td><span class="parametername">totalLimitFactor</span></td>
        <td><p>Factor to multiply adjustedTotalLimit by to decrease the chance of hitting the rate limit.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Func</span>&lt;<span class="xref">System.Int64</span>&gt;</td>
        <td><span class="parametername">tickSupplier</span></td>
        <td><p>Supplies non-descending tick time, useful for debugging.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h3 id="methods">Methods
  </h3>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/MingweiSamuel/Camille/new/release/2.x.x/apiSpec/new?filename=MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetDelay.md&amp;value=---%0Auid%3A%20MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetDelay%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/MingweiSamuel/Camille/blob/release/2.x.x/Camille/src/Util/CircularBufferTokenBucket.cs/#L121">View Source</a>
  </span>
  <a id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetDelay_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetDelay*"></a>
  <h4 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetDelay" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetDelay">GetDelay()</h4>
  <div class="markdown level1 summary"><p>Gets the delay till next available token, or -1 if available.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public long GetDelay()</code></pre>
  </div>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.Int64</span></td>
        <td><p>Delay in ticks, or -1 if available.</p>
</td>
      </tr>
    </tbody>
  </table>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/MingweiSamuel/Camille/new/release/2.x.x/apiSpec/new?filename=MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTickSpan.md&amp;value=---%0Auid%3A%20MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTickSpan%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/MingweiSamuel/Camille/blob/release/2.x.x/Camille/src/Util/CircularBufferTokenBucket.cs/#L201">View Source</a>
  </span>
  <a id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTickSpan_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTickSpan*"></a>
  <h4 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTickSpan" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTickSpan">GetTickSpan()</h4>
  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public long GetTickSpan()</code></pre>
  </div>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.Int64</span></td>
        <td></td>
      </tr>
    </tbody>
  </table>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/MingweiSamuel/Camille/new/release/2.x.x/apiSpec/new?filename=MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTokens_System_Int32_.md&amp;value=---%0Auid%3A%20MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTokens(System.Int32)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/MingweiSamuel/Camille/blob/release/2.x.x/Camille/src/Util/CircularBufferTokenBucket.cs/#L190">View Source</a>
  </span>
  <a id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTokens_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTokens*"></a>
  <h4 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTokens_System_Int32_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTokens(System.Int32)">GetTokens(Int32)</h4>
  <div class="markdown level1 summary"><p>Gets n tokens, regardless of whether they are available.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool GetTokens(int n)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.Int32</span></td>
        <td><span class="parametername">n</span></td>
        <td><p>Number of tokens to get.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.Boolean</span></td>
        <td><p>True if the tokens were obtained without violating limits, false otherwise.</p>
</td>
      </tr>
    </tbody>
  </table>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/MingweiSamuel/Camille/new/release/2.x.x/apiSpec/new?filename=MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTotalLimit.md&amp;value=---%0Auid%3A%20MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTotalLimit%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/MingweiSamuel/Camille/blob/release/2.x.x/Camille/src/Util/CircularBufferTokenBucket.cs/#L206">View Source</a>
  </span>
  <a id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTotalLimit_" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTotalLimit*"></a>
  <h4 id="MingweiSamuel_Camille_Util_CircularBufferTokenBucket_GetTotalLimit" data-uid="MingweiSamuel.Camille.Util.CircularBufferTokenBucket.GetTotalLimit">GetTotalLimit()</h4>
  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int GetTotalLimit()</code></pre>
  </div>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">System.Int32</span></td>
        <td></td>
      </tr>
    </tbody>
  </table>
  <h3 id="implements">Implements</h3>
  <div>
      <a class="xref" href="MingweiSamuel.Camille.Util.ITokenBucket.html">ITokenBucket</a>
  </div>
  <h3 id="extensionmethods">Extension Methods</h3>
  <div>
      <a class="xref" href="MingweiSamuel.Camille.Util.TokenBucketUtils.html#MingweiSamuel_Camille_Util_TokenBucketUtils_ToLimitString_MingweiSamuel_Camille_Util_ITokenBucket_">TokenBucketUtils.ToLimitString(ITokenBucket)</a>
  </div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/MingweiSamuel/Camille/new/release/2.x.x/apiSpec/new?filename=MingweiSamuel_Camille_Util_CircularBufferTokenBucket.md&amp;value=---%0Auid%3A%20MingweiSamuel.Camille.Util.CircularBufferTokenBucket%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A" class="contribution-link">Improve this Doc</a>
                  </li>
                  <li>
                    <a href="https://github.com/MingweiSamuel/Camille/blob/release/2.x.x/Camille/src/Util/CircularBufferTokenBucket.cs/#L49" class="contribution-link">View Source</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
